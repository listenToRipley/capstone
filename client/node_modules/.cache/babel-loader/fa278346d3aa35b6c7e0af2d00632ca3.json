{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (client) {\n  var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : options,\n      _ref$jwksRequestsPerM = _ref.jwksRequestsPerMinute,\n      jwksRequestsPerMinute = _ref$jwksRequestsPerM === undefined ? 10 : _ref$jwksRequestsPerM;\n\n  var logger = (0, _debug2.default)('jwks');\n  var getSigningKey = client.getSigningKey;\n  var limiter = new _limiter.RateLimiter(jwksRequestsPerMinute, 'minute', true);\n  logger('Configured rate limiting to JWKS endpoint at ' + jwksRequestsPerMinute + '/minute');\n  return function (kid, cb) {\n    limiter.removeTokens(1, function (err, remaining) {\n      if (err) {\n        return cb(err);\n      }\n\n      logger('Requests to the JWKS endpoint available for the next minute:', remaining);\n\n      if (remaining < 0) {\n        logger('Too many requests to the JWKS endpoint');\n        return cb(new _JwksRateLimitError2.default('Too many requests to the JWKS endpoint'));\n      } else {\n        return getSigningKey(kid, cb);\n      }\n    });\n  };\n};\n\nvar _debug = require('debug');\n\nvar _debug2 = _interopRequireDefault(_debug);\n\nvar _limiter = require('limiter');\n\nvar _JwksRateLimitError = require('../errors/JwksRateLimitError');\n\nvar _JwksRateLimitError2 = _interopRequireDefault(_JwksRateLimitError);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}","map":{"version":3,"sources":["/Users/moonbox/Documents/capstone/pantrypal/node_modules/jwks-rsa/lib/wrappers/rateLimit.js"],"names":["Object","defineProperty","exports","value","default","client","_ref","arguments","length","undefined","options","_ref$jwksRequestsPerM","jwksRequestsPerMinute","logger","_debug2","getSigningKey","limiter","_limiter","RateLimiter","kid","cb","removeTokens","err","remaining","_JwksRateLimitError2","_debug","require","_interopRequireDefault","_JwksRateLimitError","obj","__esModule"],"mappings":"AAAA;;AAEAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAC3CC,EAAAA,KAAK,EAAE;AADoC,CAA7C;;AAIAD,OAAO,CAACE,OAAR,GAAkB,UAAUC,MAAV,EAAkB;AAClC,MAAIC,IAAI,GAAGC,SAAS,CAACC,MAAV,GAAmB,CAAnB,IAAwBD,SAAS,CAAC,CAAD,CAAT,KAAiBE,SAAzC,GAAqDF,SAAS,CAAC,CAAD,CAA9D,GAAoEG,OAA/E;AAAA,MACIC,qBAAqB,GAAGL,IAAI,CAACM,qBADjC;AAAA,MAEIA,qBAAqB,GAAGD,qBAAqB,KAAKF,SAA1B,GAAsC,EAAtC,GAA2CE,qBAFvE;;AAIA,MAAIE,MAAM,GAAG,CAAC,GAAGC,OAAO,CAACV,OAAZ,EAAqB,MAArB,CAAb;AACA,MAAIW,aAAa,GAAGV,MAAM,CAACU,aAA3B;AAEA,MAAIC,OAAO,GAAG,IAAIC,QAAQ,CAACC,WAAb,CAAyBN,qBAAzB,EAAgD,QAAhD,EAA0D,IAA1D,CAAd;AACAC,EAAAA,MAAM,CAAC,kDAAkDD,qBAAlD,GAA0E,SAA3E,CAAN;AAEA,SAAO,UAAUO,GAAV,EAAeC,EAAf,EAAmB;AACxBJ,IAAAA,OAAO,CAACK,YAAR,CAAqB,CAArB,EAAwB,UAAUC,GAAV,EAAeC,SAAf,EAA0B;AAChD,UAAID,GAAJ,EAAS;AACP,eAAOF,EAAE,CAACE,GAAD,CAAT;AACD;;AAEDT,MAAAA,MAAM,CAAC,8DAAD,EAAiEU,SAAjE,CAAN;;AACA,UAAIA,SAAS,GAAG,CAAhB,EAAmB;AACjBV,QAAAA,MAAM,CAAC,wCAAD,CAAN;AACA,eAAOO,EAAE,CAAC,IAAII,oBAAoB,CAACpB,OAAzB,CAAiC,wCAAjC,CAAD,CAAT;AACD,OAHD,MAGO;AACL,eAAOW,aAAa,CAACI,GAAD,EAAMC,EAAN,CAApB;AACD;AACF,KAZD;AAaD,GAdD;AAeD,CA1BD;;AA4BA,IAAIK,MAAM,GAAGC,OAAO,CAAC,OAAD,CAApB;;AAEA,IAAIZ,OAAO,GAAGa,sBAAsB,CAACF,MAAD,CAApC;;AAEA,IAAIR,QAAQ,GAAGS,OAAO,CAAC,SAAD,CAAtB;;AAEA,IAAIE,mBAAmB,GAAGF,OAAO,CAAC,8BAAD,CAAjC;;AAEA,IAAIF,oBAAoB,GAAGG,sBAAsB,CAACC,mBAAD,CAAjD;;AAEA,SAASD,sBAAT,CAAgCE,GAAhC,EAAqC;AAAE,SAAOA,GAAG,IAAIA,GAAG,CAACC,UAAX,GAAwBD,GAAxB,GAA8B;AAAEzB,IAAAA,OAAO,EAAEyB;AAAX,GAArC;AAAwD","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (client) {\n  var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : options,\n      _ref$jwksRequestsPerM = _ref.jwksRequestsPerMinute,\n      jwksRequestsPerMinute = _ref$jwksRequestsPerM === undefined ? 10 : _ref$jwksRequestsPerM;\n\n  var logger = (0, _debug2.default)('jwks');\n  var getSigningKey = client.getSigningKey;\n\n  var limiter = new _limiter.RateLimiter(jwksRequestsPerMinute, 'minute', true);\n  logger('Configured rate limiting to JWKS endpoint at ' + jwksRequestsPerMinute + '/minute');\n\n  return function (kid, cb) {\n    limiter.removeTokens(1, function (err, remaining) {\n      if (err) {\n        return cb(err);\n      }\n\n      logger('Requests to the JWKS endpoint available for the next minute:', remaining);\n      if (remaining < 0) {\n        logger('Too many requests to the JWKS endpoint');\n        return cb(new _JwksRateLimitError2.default('Too many requests to the JWKS endpoint'));\n      } else {\n        return getSigningKey(kid, cb);\n      }\n    });\n  };\n};\n\nvar _debug = require('debug');\n\nvar _debug2 = _interopRequireDefault(_debug);\n\nvar _limiter = require('limiter');\n\nvar _JwksRateLimitError = require('../errors/JwksRateLimitError');\n\nvar _JwksRateLimitError2 = _interopRequireDefault(_JwksRateLimitError);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }"]},"metadata":{},"sourceType":"script"}