{"ast":null,"code":"var CC = require('config-chain').ConfigChain;\n\nvar inherits = require('inherits');\n\nvar configDefs = require('./defaults.js');\n\nvar types = configDefs.types;\n\nvar once = require('once');\n\nvar fs = require('fs');\n\nvar path = require('path');\n\nvar nopt = require('nopt');\n\nvar ini = require('ini');\n\nvar Umask = configDefs.Umask;\n\nvar mkdirp = require('gentle-fs').mkdir;\n\nvar umask = require('../utils/umask');\n\nvar isWindows = require('../utils/is-windows.js');\n\nexports.load = load;\nexports.Conf = Conf;\nexports.loaded = false;\nexports.rootConf = null;\nexports.usingBuiltin = false;\nexports.defs = configDefs;\nObject.defineProperty(exports, 'defaults', {\n  get: function () {\n    return configDefs.defaults;\n  },\n  enumerable: true\n});\nObject.defineProperty(exports, 'types', {\n  get: function () {\n    return configDefs.types;\n  },\n  enumerable: true\n});\nexports.validate = validate;\nvar myUid = process.getuid && process.getuid();\nvar myGid = process.getgid && process.getgid();\nvar loading = false;\nvar loadCbs = [];\n\nfunction load() {\n  var cli, builtin, cb;\n\n  for (var i = 0; i < arguments.length; i++) {\n    switch (typeof arguments[i]) {\n      case 'string':\n        builtin = arguments[i];\n        break;\n\n      case 'object':\n        cli = arguments[i];\n        break;\n\n      case 'function':\n        cb = arguments[i];\n        break;\n    }\n  }\n\n  if (!cb) cb = function () {};\n\n  if (exports.loaded) {\n    var ret = exports.loaded;\n\n    if (cli) {\n      ret = new Conf(ret);\n      ret.unshift(cli);\n    }\n\n    return process.nextTick(cb.bind(null, null, ret));\n  } // either a fresh object, or a clone of the passed in obj\n\n\n  if (!cli) {\n    cli = {};\n  } else {\n    cli = Object.keys(cli).reduce(function (c, k) {\n      c[k] = cli[k];\n      return c;\n    }, {});\n  }\n\n  loadCbs.push(cb);\n  if (loading) return;\n  loading = true;\n  cb = once(function (er, conf) {\n    if (!er) {\n      exports.loaded = conf;\n      loading = false;\n    }\n\n    loadCbs.forEach(function (fn) {\n      fn(er, conf);\n    });\n    loadCbs.length = 0;\n  }); // check for a builtin if provided.\n\n  exports.usingBuiltin = !!builtin;\n  var rc = exports.rootConf = new Conf();\n\n  if (builtin) {\n    rc.addFile(builtin, 'builtin');\n  } else {\n    rc.add({}, 'builtin');\n  }\n\n  rc.on('load', function () {\n    load_(builtin, rc, cli, cb);\n  });\n  rc.on('error', cb);\n}\n\nfunction load_(builtin, rc, cli, cb) {\n  var defaults = configDefs.defaults;\n  var conf = new Conf(rc);\n  conf.usingBuiltin = !!builtin;\n  conf.add(cli, 'cli');\n  conf.addEnv();\n  conf.loadPrefix(function (er) {\n    if (er) return cb(er); // If you're doing `npm --userconfig=~/foo.npmrc` then you'd expect\n    // that ~/.npmrc won't override the stuff in ~/foo.npmrc (or, indeed\n    // be used at all).\n    //\n    // However, if the cwd is ~, then ~/.npmrc is the home for the project\n    // config, and will override the userconfig.\n    //\n    // If you're not setting the userconfig explicitly, then it will be loaded\n    // twice, which is harmless but excessive.  If you *are* setting the\n    // userconfig explicitly then it will override your explicit intent, and\n    // that IS harmful and unexpected.\n    //\n    // Solution: Do not load project config file that is the same as either\n    // the default or resolved userconfig value.  npm will log a \"verbose\"\n    // message about this when it happens, but it is a rare enough edge case\n    // that we don't have to be super concerned about it.\n\n    var projectConf = path.resolve(conf.localPrefix, '.npmrc');\n    var defaultUserConfig = rc.get('userconfig');\n    var resolvedUserConfig = conf.get('userconfig');\n\n    if (!conf.get('global') && projectConf !== defaultUserConfig && projectConf !== resolvedUserConfig) {\n      conf.addFile(projectConf, 'project');\n      conf.once('load', afterPrefix);\n    } else {\n      conf.add({}, 'project');\n      afterPrefix();\n    }\n  });\n\n  function afterPrefix() {\n    conf.addFile(conf.get('userconfig'), 'user');\n    conf.once('error', cb);\n    conf.once('load', afterUser);\n  }\n\n  function afterUser() {\n    // globalconfig and globalignorefile defaults\n    // need to respond to the 'prefix' setting up to this point.\n    // Eg, `npm config get globalconfig --prefix ~/local` should\n    // return `~/local/etc/npmrc`\n    // annoying humans and their expectations!\n    if (conf.get('prefix')) {\n      var etc = path.resolve(conf.get('prefix'), 'etc');\n      defaults.globalconfig = path.resolve(etc, 'npmrc');\n      defaults.globalignorefile = path.resolve(etc, 'npmignore');\n    }\n\n    conf.addFile(conf.get('globalconfig'), 'global'); // move the builtin into the conf stack now.\n\n    conf.root = defaults;\n    conf.add(rc.shift(), 'builtin');\n    conf.once('load', function () {\n      conf.loadExtras(afterExtras);\n    });\n  }\n\n  function afterExtras(er) {\n    if (er) return cb(er); // warn about invalid bits.\n\n    validate(conf);\n    var cafile = conf.get('cafile');\n\n    if (cafile) {\n      return conf.loadCAFile(cafile, finalize);\n    }\n\n    finalize();\n  }\n\n  function finalize(er) {\n    if (er) {\n      return cb(er);\n    }\n\n    exports.loaded = conf;\n    cb(er, conf);\n  }\n} // Basically the same as CC, but:\n// 1. Always ini\n// 2. Parses environment variable names in field values\n// 3. Field values that start with ~/ are replaced with process.env.HOME\n// 4. Can inherit from another Conf object, using it as the base.\n\n\ninherits(Conf, CC);\n\nfunction Conf(base) {\n  if (!(this instanceof Conf)) return new Conf(base);\n  CC.call(this);\n\n  if (base) {\n    if (base instanceof Conf) {\n      this.root = base.list[0] || base.root;\n    } else {\n      this.root = base;\n    }\n  } else {\n    this.root = configDefs.defaults;\n  }\n}\n\nConf.prototype.loadPrefix = require('./load-prefix.js');\nConf.prototype.loadCAFile = require('./load-cafile.js');\nConf.prototype.setUser = require('./set-user.js');\nConf.prototype.getCredentialsByURI = require('./get-credentials-by-uri.js');\nConf.prototype.setCredentialsByURI = require('./set-credentials-by-uri.js');\nConf.prototype.clearCredentialsByURI = require('./clear-credentials-by-uri.js');\n\nConf.prototype.loadExtras = function (cb) {\n  this.setUser(function (er) {\n    if (er) return cb(er); // Without prefix, nothing will ever work\n\n    mkdirp(this.prefix, cb);\n  }.bind(this));\n};\n\nConf.prototype.save = function (where, cb) {\n  var target = this.sources[where];\n\n  if (!target || !(target.path || target.source) || !target.data) {\n    var er;\n    if (where !== 'builtin') er = new Error('bad save target: ' + where);\n\n    if (cb) {\n      process.nextTick(cb.bind(null, er));\n      return this;\n    }\n\n    return this.emit('error', er);\n  }\n\n  if (target.source) {\n    var pref = target.prefix || '';\n    Object.keys(target.data).forEach(function (k) {\n      target.source[pref + k] = target.data[k];\n    });\n    if (cb) process.nextTick(cb);\n    return this;\n  }\n\n  var data = ini.stringify(target.data);\n\n  var then = function then(er) {\n    if (er) return done(er);\n    fs.chmod(target.path, mode, done);\n  };\n\n  var done = function done(er) {\n    if (er) {\n      if (cb) return cb(er);else return this.emit('error', er);\n    }\n\n    this._saving--;\n\n    if (this._saving === 0) {\n      if (cb) cb();\n      this.emit('save');\n    }\n  };\n\n  then = then.bind(this);\n  done = done.bind(this);\n  this._saving++;\n  var mode = where === 'user' ? '0600' : '0666';\n\n  if (!data.trim()) {\n    fs.unlink(target.path, function () {\n      // ignore the possible error (e.g. the file doesn't exist)\n      done(null);\n    });\n  } else {\n    // we don't have to use inferOwner here, because gentle-fs will\n    // mkdir with the correctly inferred ownership.  Just preserve it.\n    const dir = path.dirname(target.path);\n    mkdirp(dir, function (er) {\n      if (er) return then(er);\n      fs.stat(dir, (er, st) => {\n        if (er) return then(er);\n        fs.writeFile(target.path, data, 'utf8', function (er) {\n          if (er) return then(er);\n\n          if (myUid === 0 && (myUid !== st.uid || myGid !== st.gid)) {\n            fs.chown(target.path, st.uid, st.gid, then);\n          } else {\n            then();\n          }\n        });\n      });\n    });\n  }\n\n  return this;\n};\n\nConf.prototype.addFile = function (file, name) {\n  name = name || file;\n  var marker = {\n    __source__: name\n  };\n  this.sources[name] = {\n    path: file,\n    type: 'ini'\n  };\n  this.push(marker);\n\n  this._await();\n\n  fs.readFile(file, 'utf8', function (er, data) {\n    // just ignore missing files.\n    if (er) return this.add({}, marker);\n    this.addString(data, file, 'ini', marker);\n  }.bind(this));\n  return this;\n}; // always ini files.\n\n\nConf.prototype.parse = function (content, file) {\n  return CC.prototype.parse.call(this, content, file, 'ini');\n};\n\nConf.prototype.add = function (data, marker) {\n  try {\n    Object.keys(data).forEach(function (k) {\n      const newKey = envReplace(k);\n      const newField = parseField(data[k], newKey);\n      delete data[k];\n      data[newKey] = newField;\n    });\n  } catch (e) {\n    this.emit('error', e);\n    return this;\n  }\n\n  return CC.prototype.add.call(this, data, marker);\n};\n\nConf.prototype.addEnv = function (env) {\n  env = env || process.env;\n  var conf = {};\n  Object.keys(env).filter(function (k) {\n    return k.match(/^npm_config_/i);\n  }).forEach(function (k) {\n    if (!env[k]) return; // leave first char untouched, even if\n    // it is a '_' - convert all other to '-'\n\n    var p = k.toLowerCase().replace(/^npm_config_/, '').replace(/(?!^)_/g, '-');\n    conf[p] = env[k];\n  });\n  return CC.prototype.addEnv.call(this, '', conf, 'env');\n};\n\nfunction parseField(f, k) {\n  if (typeof f !== 'string' && !(f instanceof String)) return f; // type can be an array or single thing.\n\n  var typeList = [].concat(types[k]);\n  var isPath = typeList.indexOf(path) !== -1;\n  var isBool = typeList.indexOf(Boolean) !== -1;\n  var isString = typeList.indexOf(String) !== -1;\n  var isUmask = typeList.indexOf(Umask) !== -1;\n  var isNumber = typeList.indexOf(Number) !== -1;\n  f = ('' + f).trim();\n\n  if (f.match(/^\".*\"$/)) {\n    try {\n      f = JSON.parse(f);\n    } catch (e) {\n      throw new Error('Failed parsing JSON config key ' + k + ': ' + f);\n    }\n  }\n\n  if (isBool && !isString && f === '') return true;\n\n  switch (f) {\n    case 'true':\n      return true;\n\n    case 'false':\n      return false;\n\n    case 'null':\n      return null;\n\n    case 'undefined':\n      return undefined;\n  }\n\n  f = envReplace(f);\n\n  if (isPath) {\n    var homePattern = isWindows ? /^~(\\/|\\\\)/ : /^~\\//;\n\n    if (f.match(homePattern) && process.env.HOME) {\n      f = path.resolve(process.env.HOME, f.substr(2));\n    }\n\n    f = path.resolve(f);\n  }\n\n  if (isUmask) f = umask.fromString(f);\n  if (isNumber && !isNaN(f)) f = +f;\n  return f;\n}\n\nfunction envReplace(f) {\n  if (typeof f !== 'string' || !f) return f; // replace any ${ENV} values with the appropriate environ.\n\n  var envExpr = /(\\\\*)\\$\\{([^}]+)\\}/g;\n  return f.replace(envExpr, function (orig, esc, name) {\n    esc = esc.length && esc.length % 2;\n    if (esc) return orig;\n\n    if (undefined === process.env[name]) {\n      throw new Error('Failed to replace env in config: ' + orig);\n    }\n\n    return process.env[name];\n  });\n}\n\nfunction validate(cl) {\n  // warn about invalid configs at every level.\n  cl.list.forEach(function (conf) {\n    nopt.clean(conf, configDefs.types);\n  });\n  nopt.clean(cl.root, configDefs.types);\n}","map":{"version":3,"sources":["/Users/moonbox/Documents/capstone/pantrypal/client/node_modules/npm/lib/config/core.js"],"names":["CC","require","ConfigChain","inherits","configDefs","types","once","fs","path","nopt","ini","Umask","mkdirp","mkdir","umask","isWindows","exports","load","Conf","loaded","rootConf","usingBuiltin","defs","Object","defineProperty","get","defaults","enumerable","validate","myUid","process","getuid","myGid","getgid","loading","loadCbs","cli","builtin","cb","i","arguments","length","ret","unshift","nextTick","bind","keys","reduce","c","k","push","er","conf","forEach","fn","rc","addFile","add","on","load_","addEnv","loadPrefix","projectConf","resolve","localPrefix","defaultUserConfig","resolvedUserConfig","afterPrefix","afterUser","etc","globalconfig","globalignorefile","root","shift","loadExtras","afterExtras","cafile","loadCAFile","finalize","base","call","list","prototype","setUser","getCredentialsByURI","setCredentialsByURI","clearCredentialsByURI","prefix","save","where","target","sources","source","data","Error","emit","pref","stringify","then","done","chmod","mode","_saving","trim","unlink","dir","dirname","stat","st","writeFile","uid","gid","chown","file","name","marker","__source__","type","_await","readFile","addString","parse","content","newKey","envReplace","newField","parseField","e","env","filter","match","p","toLowerCase","replace","f","String","typeList","concat","isPath","indexOf","isBool","Boolean","isString","isUmask","isNumber","Number","JSON","undefined","homePattern","HOME","substr","fromString","isNaN","envExpr","orig","esc","cl","clean"],"mappings":"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","sourcesContent":["var CC = require('config-chain').ConfigChain\nvar inherits = require('inherits')\nvar configDefs = require('./defaults.js')\nvar types = configDefs.types\nvar once = require('once')\nvar fs = require('fs')\nvar path = require('path')\nvar nopt = require('nopt')\nvar ini = require('ini')\nvar Umask = configDefs.Umask\nvar mkdirp = require('gentle-fs').mkdir\nvar umask = require('../utils/umask')\nvar isWindows = require('../utils/is-windows.js')\n\nexports.load = load\nexports.Conf = Conf\nexports.loaded = false\nexports.rootConf = null\nexports.usingBuiltin = false\nexports.defs = configDefs\n\nObject.defineProperty(exports, 'defaults', { get: function () {\n  return configDefs.defaults\n},\nenumerable: true })\n\nObject.defineProperty(exports, 'types', { get: function () {\n  return configDefs.types\n},\nenumerable: true })\n\nexports.validate = validate\n\nvar myUid = process.getuid && process.getuid()\nvar myGid = process.getgid && process.getgid()\n\nvar loading = false\nvar loadCbs = []\nfunction load () {\n  var cli, builtin, cb\n  for (var i = 0; i < arguments.length; i++) {\n    switch (typeof arguments[i]) {\n      case 'string': builtin = arguments[i]; break\n      case 'object': cli = arguments[i]; break\n      case 'function': cb = arguments[i]; break\n    }\n  }\n\n  if (!cb) cb = function () {}\n\n  if (exports.loaded) {\n    var ret = exports.loaded\n    if (cli) {\n      ret = new Conf(ret)\n      ret.unshift(cli)\n    }\n    return process.nextTick(cb.bind(null, null, ret))\n  }\n\n  // either a fresh object, or a clone of the passed in obj\n  if (!cli) {\n    cli = {}\n  } else {\n    cli = Object.keys(cli).reduce(function (c, k) {\n      c[k] = cli[k]\n      return c\n    }, {})\n  }\n\n  loadCbs.push(cb)\n  if (loading) return\n\n  loading = true\n\n  cb = once(function (er, conf) {\n    if (!er) {\n      exports.loaded = conf\n      loading = false\n    }\n    loadCbs.forEach(function (fn) {\n      fn(er, conf)\n    })\n    loadCbs.length = 0\n  })\n\n  // check for a builtin if provided.\n  exports.usingBuiltin = !!builtin\n  var rc = exports.rootConf = new Conf()\n  if (builtin) {\n    rc.addFile(builtin, 'builtin')\n  } else {\n    rc.add({}, 'builtin')\n  }\n\n  rc.on('load', function () {\n    load_(builtin, rc, cli, cb)\n  })\n  rc.on('error', cb)\n}\n\nfunction load_ (builtin, rc, cli, cb) {\n  var defaults = configDefs.defaults\n  var conf = new Conf(rc)\n\n  conf.usingBuiltin = !!builtin\n  conf.add(cli, 'cli')\n  conf.addEnv()\n\n  conf.loadPrefix(function (er) {\n    if (er) return cb(er)\n\n    // If you're doing `npm --userconfig=~/foo.npmrc` then you'd expect\n    // that ~/.npmrc won't override the stuff in ~/foo.npmrc (or, indeed\n    // be used at all).\n    //\n    // However, if the cwd is ~, then ~/.npmrc is the home for the project\n    // config, and will override the userconfig.\n    //\n    // If you're not setting the userconfig explicitly, then it will be loaded\n    // twice, which is harmless but excessive.  If you *are* setting the\n    // userconfig explicitly then it will override your explicit intent, and\n    // that IS harmful and unexpected.\n    //\n    // Solution: Do not load project config file that is the same as either\n    // the default or resolved userconfig value.  npm will log a \"verbose\"\n    // message about this when it happens, but it is a rare enough edge case\n    // that we don't have to be super concerned about it.\n    var projectConf = path.resolve(conf.localPrefix, '.npmrc')\n    var defaultUserConfig = rc.get('userconfig')\n    var resolvedUserConfig = conf.get('userconfig')\n    if (!conf.get('global') &&\n        projectConf !== defaultUserConfig &&\n        projectConf !== resolvedUserConfig) {\n      conf.addFile(projectConf, 'project')\n      conf.once('load', afterPrefix)\n    } else {\n      conf.add({}, 'project')\n      afterPrefix()\n    }\n  })\n\n  function afterPrefix () {\n    conf.addFile(conf.get('userconfig'), 'user')\n    conf.once('error', cb)\n    conf.once('load', afterUser)\n  }\n\n  function afterUser () {\n    // globalconfig and globalignorefile defaults\n    // need to respond to the 'prefix' setting up to this point.\n    // Eg, `npm config get globalconfig --prefix ~/local` should\n    // return `~/local/etc/npmrc`\n    // annoying humans and their expectations!\n    if (conf.get('prefix')) {\n      var etc = path.resolve(conf.get('prefix'), 'etc')\n      defaults.globalconfig = path.resolve(etc, 'npmrc')\n      defaults.globalignorefile = path.resolve(etc, 'npmignore')\n    }\n\n    conf.addFile(conf.get('globalconfig'), 'global')\n\n    // move the builtin into the conf stack now.\n    conf.root = defaults\n    conf.add(rc.shift(), 'builtin')\n    conf.once('load', function () {\n      conf.loadExtras(afterExtras)\n    })\n  }\n\n  function afterExtras (er) {\n    if (er) return cb(er)\n\n    // warn about invalid bits.\n    validate(conf)\n\n    var cafile = conf.get('cafile')\n\n    if (cafile) {\n      return conf.loadCAFile(cafile, finalize)\n    }\n\n    finalize()\n  }\n\n  function finalize (er) {\n    if (er) {\n      return cb(er)\n    }\n\n    exports.loaded = conf\n    cb(er, conf)\n  }\n}\n\n// Basically the same as CC, but:\n// 1. Always ini\n// 2. Parses environment variable names in field values\n// 3. Field values that start with ~/ are replaced with process.env.HOME\n// 4. Can inherit from another Conf object, using it as the base.\ninherits(Conf, CC)\nfunction Conf (base) {\n  if (!(this instanceof Conf)) return new Conf(base)\n\n  CC.call(this)\n\n  if (base) {\n    if (base instanceof Conf) {\n      this.root = base.list[0] || base.root\n    } else {\n      this.root = base\n    }\n  } else {\n    this.root = configDefs.defaults\n  }\n}\n\nConf.prototype.loadPrefix = require('./load-prefix.js')\nConf.prototype.loadCAFile = require('./load-cafile.js')\nConf.prototype.setUser = require('./set-user.js')\nConf.prototype.getCredentialsByURI = require('./get-credentials-by-uri.js')\nConf.prototype.setCredentialsByURI = require('./set-credentials-by-uri.js')\nConf.prototype.clearCredentialsByURI = require('./clear-credentials-by-uri.js')\n\nConf.prototype.loadExtras = function (cb) {\n  this.setUser(function (er) {\n    if (er) return cb(er)\n    // Without prefix, nothing will ever work\n    mkdirp(this.prefix, cb)\n  }.bind(this))\n}\n\nConf.prototype.save = function (where, cb) {\n  var target = this.sources[where]\n  if (!target || !(target.path || target.source) || !target.data) {\n    var er\n    if (where !== 'builtin') er = new Error('bad save target: ' + where)\n    if (cb) {\n      process.nextTick(cb.bind(null, er))\n      return this\n    }\n    return this.emit('error', er)\n  }\n\n  if (target.source) {\n    var pref = target.prefix || ''\n    Object.keys(target.data).forEach(function (k) {\n      target.source[pref + k] = target.data[k]\n    })\n    if (cb) process.nextTick(cb)\n    return this\n  }\n\n  var data = ini.stringify(target.data)\n\n  var then = function then (er) {\n    if (er) return done(er)\n\n    fs.chmod(target.path, mode, done)\n  }\n\n  var done = function done (er) {\n    if (er) {\n      if (cb) return cb(er)\n      else return this.emit('error', er)\n    }\n    this._saving--\n    if (this._saving === 0) {\n      if (cb) cb()\n      this.emit('save')\n    }\n  }\n\n  then = then.bind(this)\n  done = done.bind(this)\n  this._saving++\n\n  var mode = where === 'user' ? '0600' : '0666'\n  if (!data.trim()) {\n    fs.unlink(target.path, function () {\n      // ignore the possible error (e.g. the file doesn't exist)\n      done(null)\n    })\n  } else {\n    // we don't have to use inferOwner here, because gentle-fs will\n    // mkdir with the correctly inferred ownership.  Just preserve it.\n    const dir = path.dirname(target.path)\n    mkdirp(dir, function (er) {\n      if (er) return then(er)\n      fs.stat(dir, (er, st) => {\n        if (er) return then(er)\n        fs.writeFile(target.path, data, 'utf8', function (er) {\n          if (er) return then(er)\n          if (myUid === 0 && (myUid !== st.uid || myGid !== st.gid)) {\n            fs.chown(target.path, st.uid, st.gid, then)\n          } else {\n            then()\n          }\n        })\n      })\n    })\n  }\n\n  return this\n}\n\nConf.prototype.addFile = function (file, name) {\n  name = name || file\n  var marker = { __source__: name }\n  this.sources[name] = { path: file, type: 'ini' }\n  this.push(marker)\n  this._await()\n  fs.readFile(file, 'utf8', function (er, data) {\n    // just ignore missing files.\n    if (er) return this.add({}, marker)\n\n    this.addString(data, file, 'ini', marker)\n  }.bind(this))\n  return this\n}\n\n// always ini files.\nConf.prototype.parse = function (content, file) {\n  return CC.prototype.parse.call(this, content, file, 'ini')\n}\n\nConf.prototype.add = function (data, marker) {\n  try {\n    Object.keys(data).forEach(function (k) {\n      const newKey = envReplace(k)\n      const newField = parseField(data[k], newKey)\n      delete data[k]\n      data[newKey] = newField\n    })\n  } catch (e) {\n    this.emit('error', e)\n    return this\n  }\n  return CC.prototype.add.call(this, data, marker)\n}\n\nConf.prototype.addEnv = function (env) {\n  env = env || process.env\n  var conf = {}\n  Object.keys(env)\n    .filter(function (k) { return k.match(/^npm_config_/i) })\n    .forEach(function (k) {\n      if (!env[k]) return\n\n      // leave first char untouched, even if\n      // it is a '_' - convert all other to '-'\n      var p = k.toLowerCase()\n        .replace(/^npm_config_/, '')\n        .replace(/(?!^)_/g, '-')\n      conf[p] = env[k]\n    })\n  return CC.prototype.addEnv.call(this, '', conf, 'env')\n}\n\nfunction parseField (f, k) {\n  if (typeof f !== 'string' && !(f instanceof String)) return f\n\n  // type can be an array or single thing.\n  var typeList = [].concat(types[k])\n  var isPath = typeList.indexOf(path) !== -1\n  var isBool = typeList.indexOf(Boolean) !== -1\n  var isString = typeList.indexOf(String) !== -1\n  var isUmask = typeList.indexOf(Umask) !== -1\n  var isNumber = typeList.indexOf(Number) !== -1\n\n  f = ('' + f).trim()\n\n  if (f.match(/^\".*\"$/)) {\n    try {\n      f = JSON.parse(f)\n    } catch (e) {\n      throw new Error('Failed parsing JSON config key ' + k + ': ' + f)\n    }\n  }\n\n  if (isBool && !isString && f === '') return true\n\n  switch (f) {\n    case 'true': return true\n    case 'false': return false\n    case 'null': return null\n    case 'undefined': return undefined\n  }\n\n  f = envReplace(f)\n\n  if (isPath) {\n    var homePattern = isWindows ? /^~(\\/|\\\\)/ : /^~\\//\n    if (f.match(homePattern) && process.env.HOME) {\n      f = path.resolve(process.env.HOME, f.substr(2))\n    }\n    f = path.resolve(f)\n  }\n\n  if (isUmask) f = umask.fromString(f)\n\n  if (isNumber && !isNaN(f)) f = +f\n\n  return f\n}\n\nfunction envReplace (f) {\n  if (typeof f !== 'string' || !f) return f\n\n  // replace any ${ENV} values with the appropriate environ.\n  var envExpr = /(\\\\*)\\$\\{([^}]+)\\}/g\n  return f.replace(envExpr, function (orig, esc, name) {\n    esc = esc.length && esc.length % 2\n    if (esc) return orig\n    if (undefined === process.env[name]) {\n      throw new Error('Failed to replace env in config: ' + orig)\n    }\n\n    return process.env[name]\n  })\n}\n\nfunction validate (cl) {\n  // warn about invalid configs at every level.\n  cl.list.forEach(function (conf) {\n    nopt.clean(conf, configDefs.types)\n  })\n\n  nopt.clean(cl.root, configDefs.types)\n}\n"]},"metadata":{},"sourceType":"script"}